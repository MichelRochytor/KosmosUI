{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "1. Compilar Recurso (Linux)",
      "type": "shell",
      "command": "/usr/bin/x86_64-w64-mingw32-windres",
      "args": [
        "-I", "${workspaceFolder}/resource",
        "-i", "${workspaceFolder}/resource/resource.rc",
        "-o", "${workspaceFolder}/output/resource.o",
        "-O", "coff",
        "-F", "pe-x86-64"
      ],
      "group": "build",
      "problemMatcher": [],
      "presentation": { "reveal": "silent" }
    },
    {
      "label": "3. Compilar Aplicação Principal (Linux)",
      "type": "shell",
      "command": "/usr/bin/x86_64-w64-mingw32-gcc",
      "args": [
        "-mwindows",
        "-I", "${workspaceFolder}/resource",
        "-I", "${workspaceFolder}/tools/kosmos",
        "-g", "-Wall",
        "-D_WIN32_WINNT=0x0A00", "-DWINVER=0x0A00",
        "-DUNICODE", "-D_UNICODE",
        "${workspaceFolder}/src/main.c",
        "${workspaceFolder}/tools/kosmos/kosmos.c",
        "${workspaceFolder}/output/resource.o",
        "-o", "${workspaceFolder}/output/MeuApp.exe",
        "-lshcore", "-lcomctl32", "-lgdi32", "-luser32", "-lshlwapi",
        "-static-libgcc", "-static-libstdc++",
        "-Wl,--subsystem,windows", "-municode"
      ],
      "dependsOn": ["1. Compilar Recurso (Linux)"],
      "group": "build",
      "problemMatcher": ["$gcc"],
      "presentation": { "reveal": "silent" }
    },
    {
      "label": "4. Aplicar Manifest (Wine)",
      "type": "process", 
      "command": "wine",
      "args": [
        "${workspaceFolder}/tools/msys/mt.exe",
        "-nologo",
        "-manifest", "Z:${workspaceFolder}/tools/kosmos/kosmos.exe.manifest",
        "-outputresource:Z:${workspaceFolder}/output/MeuApp.exe;#1"
      ],
      "options": {
        "env": { "WINEDEBUG": "-all" }
      },
      "dependsOn": "3. Compilar Aplicação Principal (Linux)",
      "problemMatcher": [],
      "presentation": { "reveal": "silent" }
    },
    {
      "label": "5. Gerar AppImage (Linux)",
      "type": "shell",
      "command": "bash",
      "args": ["${workspaceFolder}/tools/package_linux.sh"],
      "dependsOn": "4. Aplicar Manifest (Wine)",
      "group": "build",
      "presentation": { "reveal": "silent" }
    },
    {
      "label": "Build All & Run (Linux)",
      "dependsOn": ["5. Gerar AppImage (Linux)"],
      "dependsOrder": "sequence",
      "group": {
        "kind": "build",
        "isDefault": true
      },
      
      // MUDANÇA: Agora executa o AppImage gerado diretamente!
      "type": "process",
      "command": "${workspaceFolder}/output/linux/KosmosApp-x86_64.AppImage",
      "args": [],
      
      "presentation": {
        "echo": false,
        "reveal": "never", // Sem terminal preto/debug
        "focus": false,
        "panel": "shared",
        "showReuseMessage": false,
        "clear": true
      }
    }
  ]
}